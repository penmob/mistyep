"use strict"
function addToPhysicalKeyboard(t,e){PHYSICAL_KEYS[t]=new PhysicalKey(t,e+this.x,this.y)}function toLower(t){return"string"==typeof t?t.toLowerCase():t}function matchClosestWord(t,e){var s=Number.MAX_VALUE,a=null
return e.some(function(e){var i=physicalEditDistance(e,t)
if(0===i)return a=e,!0
i<TOLERANCE&&i<s&&(s=i,a=e)}),null===a?t:a}function physicalEditDistance(t,e){var s=t.length-e.length
if(0!==s){s<0&&(t=[e,e=t][0])
for(var a=0;a<t.length;a++)t[a]!==e[a]&&(e=[e.slice(0,a)," ",e.slice(a)].join(""))
e=e.slice(0,t.length)}for(var i=0,a=0;a<t.length-1;a++){var o=PHYSICAL_KEYS.hasOwnProperty(t[a])?t[a]:" ",n=PHYSICAL_KEYS.hasOwnProperty(t[a+1])?t[a+1]:" ",r=PHYSICAL_KEYS.hasOwnProperty(e[a])?e[a]:" ",c=PHYSICAL_KEYS.hasOwnProperty(e[a+1])?e[a+1]:" "
o===c&&n===r&&" "!==o&&" "!==n&&o!==n?(i+=1,0===a||a===t.length-2?i-=PHYSICAL_KEYS[o].getDistance(PHYSICAL_KEYS[r])/2:i-=PHYSICAL_KEYS[o].getDistance(PHYSICAL_KEYS[r])):0===a?i+=PHYSICAL_KEYS[o].getDistance(PHYSICAL_KEYS[r])+PHYSICAL_KEYS[n].getDistance(PHYSICAL_KEYS[c])/2:a===t.length-2?i+=PHYSICAL_KEYS[o].getDistance(PHYSICAL_KEYS[r])/2+PHYSICAL_KEYS[n].getDistance(PHYSICAL_KEYS[c]):i+=PHYSICAL_KEYS[o].getDistance(PHYSICAL_KEYS[r])/2+PHYSICAL_KEYS[n].getDistance(PHYSICAL_KEYS[c])/2}return i}module.exports={custom:function(t,e){return e&&0!==e.length?mistyep(t,e):t},email:function(t,e){var s=["gmail","yahoo","aol","outlook","att","msn","mchsi","comcast","live","mail","ymail","googlemail","hotmail"],a=["com","co","org","net","info","edu","gov","int","mil","biz","me","ly","io","us","co.uk","ru","mobi","ad","as","bz","cc","cd","dj","fm","la","ms","nu","sc","sr","su","tv","tk","ws","eu","asia","br","ca","cn","de","fr","in","jp","ru"]
if(e){if(e.customDomains)for(var i=0;i<e.customDomains.length;i++)-1===s.indexOf(e.customDomains[i])&&s.push(e.customDomains[i])
if(e.customTLDs)for(var i=0;i<e.customTLDs.length;i++)-1===a.indexOf(e.customTLDs[i])&&a.push(e.customTLDs[i])}if(!t||"string"!=typeof t)return t
var o=t.match(/((.+)@)/)
o=o&&o.length?o[1]:""
var n=t.match(/@(.+?)\.((.+){2,})/)
n=n&&n.length>=2?n[1]:""
var r=t.match(/@(.+?)\.((.+){2,})/)
r=r&&r.length>=3?r[2]:""
var c=n&&n.length<18?mistyep(n,s):n,h=r&&r.length<8?mistyep(r,a):r
return n!==c||r!==h?o+c+"."+h:t}}
var TOLERANCE=2.5,PhysicalKey=function(t,e,s){this.ch=t,this.x=e,this.y=s,this.getDistance=function(t,e){return" "==t.ch?1:void 0===e?Math.abs(this.x-t.x)+Math.abs(this.y-t.y):Math.sqrt(Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2))}},PHYSICAL_KEYS={}
"1 2 3 4 5 6 7 8 9 0 - =".split(" ").forEach(addToPhysicalKeyboard,{x:0,y:0}),"q w e r t y u i o p [ ]".split(" ").forEach(addToPhysicalKeyboard,{x:.5,y:1}),"a s d f g h j k l".split(" ").forEach(addToPhysicalKeyboard,{x:.7,y:2}),"z x c v b n m , . /".split(" ").forEach(addToPhysicalKeyboard,{x:1.2,y:3}),PHYSICAL_KEYS[" "]=new PhysicalKey(" ",0,0)
var mistyep=function(t,e){return e=e.map(toLower),t=toLower(t),t.length>0?matchClosestWord(t,e):t}

"use strict"
function addToPhysicalKeyboard(t,e){PHYSICAL_KEYS[t]=new PhysicalKey(t,e+this.x,this.y)}function toLower(t){return"string"==typeof t?t.toLowerCase():t}function matchClosestWord(t,e){var i=Number.MAX_VALUE,o=null
return e.some(function(e){var s=physicalEditDistance(e,t)
if(0===s)return o=e,!0
s<TOLERANCE&&s<i&&(i=s,o=e)}),null===o?t:o}function physicalEditDistance(t,e){var i=t.length-e.length
if(0!==i){i<0&&(t=[e,e=t][0])
for(var o=0;o<t.length;o++)t[o]!==e[o]&&(e=[e.slice(0,o)," ",e.slice(o)].join(""))
e=e.slice(0,t.length)}for(var s=0,o=0;o<t.length-1;o++){var a=PHYSICAL_KEYS.hasOwnProperty(t[o])?t[o]:" ",n=PHYSICAL_KEYS.hasOwnProperty(t[o+1])?t[o+1]:" ",r=PHYSICAL_KEYS.hasOwnProperty(e[o])?e[o]:" ",c=PHYSICAL_KEYS.hasOwnProperty(e[o+1])?e[o+1]:" "
a===c&&n===r&&" "!==a&&" "!==n&&a!==n?(s+=1,0===o||o===t.length-2?s-=PHYSICAL_KEYS[a].getDistance(PHYSICAL_KEYS[r])/2:s-=PHYSICAL_KEYS[a].getDistance(PHYSICAL_KEYS[r])):0===o?s+=PHYSICAL_KEYS[a].getDistance(PHYSICAL_KEYS[r])+PHYSICAL_KEYS[n].getDistance(PHYSICAL_KEYS[c])/2:o===t.length-2?s+=PHYSICAL_KEYS[a].getDistance(PHYSICAL_KEYS[r])/2+PHYSICAL_KEYS[n].getDistance(PHYSICAL_KEYS[c]):s+=PHYSICAL_KEYS[a].getDistance(PHYSICAL_KEYS[r])/2+PHYSICAL_KEYS[n].getDistance(PHYSICAL_KEYS[c])/2}return s}module.exports={custom:function(t,e){return e&&0!==e.length?mistyep(t,e):t},email:function(t,e){var i=["gmail","yahoo","aol","outlook","att","msn","mchsi","comcast","live","mail","ymail","googlemail","hotmail"],o=["com","co","org","net","info","edu","gov","int","mil","biz","me","ly","io","us","co.uk","ru","mobi"]
if(e){if(e.customDomains)for(var s=0;s<e.customDomains.length;s++)-1===i.indexOf(e.customDomains[s])&&i.push(e.customDomains[s])
if(e.customTLDs)for(var s=0;s<e.customTLDs.length;s++)-1===o.indexOf(e.customTLDs[s])&&o.push(e.customTLDs[s])}if(!t||"string"!=typeof t)return t
var a=t.match(/((.+)@)/)
a=a&&a.length?a[1]:""
var n=t.match(/@(.+?)\.((.+){2,})/)
n=n&&n.length>=2?n[1]:""
var r=t.match(/@(.+?)\.((.+){2,})/)
r=r&&r.length>=3?r[2]:""
var c=n&&n.length<18?mistyep(n,i):n,h=r&&r.length<8?mistyep(r,o):r
return n!==c||r!==h?a+c+"."+h:t}}
var TOLERANCE=2.5,PhysicalKey=function(t,e,i){this.ch=t,this.x=e,this.y=i,this.getDistance=function(t,e){return" "==t.ch?1:void 0===e?Math.abs(this.x-t.x)+Math.abs(this.y-t.y):Math.sqrt(Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2))}},PHYSICAL_KEYS={}
"1 2 3 4 5 6 7 8 9 0 - =".split(" ").forEach(addToPhysicalKeyboard,{x:0,y:0}),"q w e r t y u i o p [ ]".split(" ").forEach(addToPhysicalKeyboard,{x:.5,y:1}),"a s d f g h j k l".split(" ").forEach(addToPhysicalKeyboard,{x:.7,y:2}),"z x c v b n m , . /".split(" ").forEach(addToPhysicalKeyboard,{x:1.2,y:3}),PHYSICAL_KEYS[" "]=new PhysicalKey(" ",0,0)
var mistyep=function(t,e){return e=e.map(toLower),t=toLower(t),t.length>0?matchClosestWord(t,e):t}
